# 常微分方程式と初期値問題

到達目標
- 解析的に解ける基本的な常微分方程式を理解する．
- 初期条件の違いによる解の挙動の違いを理解する．

<!-- 
全体の流れ
- **導入**：微分方程式と初期値問題（IVP）の基本・解の一意性の直観
- **可分形 ODE**：指数増減・ロジスティック（初期値の影響と平衡）
- **一次線形 ODE**：積分因子法（ニュートン冷却・RC回路・混合問題）
- **自律系と位相線**：平衡点の安定性，初期値で決まる長期挙動
- **2階の基本例**：等速落下＋線形抵抗，単振動（初期位相の役割）
- **まとめ・演習**：初期値依存の可視化・発展課題
 -->
<!-- 
## 基本的な常微分方程式

- 解析的に解ける常微分方程式の解を書き下す．
- 数値的に解を調べるために離散化を行う．
- 数値的に調べた解と解析解をプロットして比較する．
 -->

## 準備

1. anaconda を使用し，<span style="color:red">jupyter lab</span> を起動する．
2. `Documents（書類）/mathematical_studies` に新規ノートブックを作成．
3. ファイル名を `5_{学籍番号}_{氏名}.ipynb` に変更（例：`5_SI25999_香川渓一郎.ipynb`）．

## 初期値問題（Initial value problem, IVP）

- 一般形

$$
\frac{dx}{dt}=f(t,x), \qquad x(t_0)=x_0.
$$

- 意味：解$x(t)$は初期条件$x(t_0)=x_0$を満たし，常微分方程式$\frac{dx}{dt}=f(t,x)$に従って変化する．
- イメージ：
  - 微分方程式：“傾きの規則”
  - 初期値：“スタート地点”

```{warning}
解の関数$x(t)$をどの空間（関数空間）から探すかによって，解が存在するかしないか，存在するならいくつ存在するかが変わる．
```

- 解が存在する：解が1つ以上である．
- 解が一意である：解が1つ以下である．

```{note}
**定理（解の存在と一意性）**

関数$f(t,x)$が有界領域$D \subset \mathbb{R}^2$において定義され，ここで連続であり，$x$に関してリプシッツ連続であると仮定する．
すなわち正定数$L$が存在し，任意の$(t_1, x_1), (t_2, x_2) \in D$に対して：

$$
|f(t_1,x_1)-f(t_2,x_2)| < L|x_1-x_2|,
$$

を満たす．
このとき，常微分方程式の初期値問題

$$
\frac{dx}{dt}=f(t,x), \qquad x(t_0)=x_0.
$$

にはただ一つの解$x(t)$が存在する（解の一意存在）．
```

```{note}
**定義（リプシッツ連続性，Lipschitz continuity）**

$\mathbb{R}$上の関数$f(x)$が<span style="color:red">（大域）リプシッツ連続</span>であるとは，

次を満たす正定数$L>0$が存在することをいう．
すなわち任意の$x_1, x_2 \in \mathbb{R}$に対して

$$
|f(x_1)-f(x_2)| < L|x_1-x_2|.
$$

このとき，$L$をリプシッツ定数と呼ぶ．

また，$\mathbb{R}$上の関数$f(x)$が<span style="color:red">局所リプシッツ連続</span>であるとは，

任意の有界閉集合$K$に対して正定数$L=L(K)>0$が存在し，次を満たす．
すなわち任意の$x_1, x_2 \in K$に対して

$$
|f(x_1)-f(x_2)| < L|x_1-x_2|.
$$
```

定理の主張が成り立つ関数の例と，仮定を満たさない関数の例を知ることは，定理を使いこなす上で重要．
```{tip}
$\mathbb{R}$で定義された関数を考える．

**大域リプシッツ連続な関数の例**

- $f(x) = 1$
- $f(x) = x$
- $f(x) = 2x+3$

**局所リプシッツ連続な関数の例**

- $f(x) = x^2$
- $f(x) = x^9$
- $f(x) = e^x$

**局所リプシッツ連続でない関数の例**

- $f(x) = \tan(x)$
- $f(x) = |x|^{\frac12}$
```

<!-- 
- **解が存在・一意になる直観**（ピカール＝リンドレフのイメージ）：
  右辺 (f) が **連続**で (x) に関して「滑らか（リプシッツ）」なら，**同じ初期値から出る解は1本**だけ．
 -->

## 解ける常微分方程式の例

### 変数分離形

- 一般形

$$
&\frac{dx}{dt} = f(t)g(x),
\\
&x(t=0)=x_0.
$$

ただし$g(x) \ne 0$．

- 解法

$$
\int_{x(t=0)}^{x(t)} \frac{1}{g(x)} dx = \int_{0}^{t} f(t) dt + C.
$$

ただし $C$ は積分定数であり，初期条件から定まる．

```{tip}
**例**

- 生物の増殖現象（マルサスモデル）
- 飽和を加味した生物の増殖現象（ロジスティックモデル）
- 放射性崩壊
- 銀行の利子
```

```{note}
**生物の増殖現象（マルサスモデル）**

$$
&\frac{dN}{dt}=r N,
\\
&N(t=0)=N_0,
$$

の解は

$$
N(t)=N_0 e^{r t},
$$

となる．
```

```{note}
**飽和を加味した生物の増殖現象（ロジスティックモデル）**

$$
&\frac{dN}{dt} = rN\left(1 - \frac{N}{N_{\text{max}}}\right),
\\
&N(t=0) = N_0,
$$

の解は

$$
N(t) = \frac{N_{\text{max}}N_0}{N_0 + \left(N_{\text{max}} - N_0\right)e^{-rt}},
$$

となる．
```

### 同次形

- 一般形

$$
&\frac{dx}{dt} = f\left(\frac{x}{t}\right),
\\
&x(t=0)=x_0.
$$

- 解法
  - 新しい未知関数$y(t)$を$x(t)=ty(t)$として導入すると，$x'(t)=ty'(t)+y(t)$であるから変数分離形

    $$
    \frac{dy}{dt} = \frac{f(y) - y}{t},
    $$

    に帰着できる．
    従って

    $$
    \int_{y(t=0)}^{y(t)} \frac{1}{f(y)-y} dy = \int_{0}^{t} \frac{1}{t} dt + C,
    $$

    とすれば解ける．

```{tip}
**例**

- スケール不変性の潜む現象
```

### 一階線形

- 一般形

$$
&\frac{dx}{dt}+p(t)x=q(t),
\\
&x(t=0)=x_0.
$$

- 解法
  - **積分因子** $\mu(t)=e^{\int_0^t p(s) ds}$ を掛けると $\frac{d}{dt}\big(\mu x\big)=\mu q$ となるので

    $$
    & x(t)=\frac{1}{\mu(t)}\Bigl(C+\int_{0}^{t}\mu(s)q(s)ds\Bigr),
    \\
    & C=\mu(0)x_0,
    $$

```{note}
**ニュートン冷却**

$$
& \frac{dT}{dt}=-k\big(T-T_{\rm env}\big),
\\
& T(0)=T_0,
$$

の解は

$$
T(t)=T_{\rm env}+(T_0-T_{\rm env})e^{-kt},
$$

となる．
```

<!-- 
```{note}
**RC回路（充放電）**

$$
& C\frac{dV}{dt}+\frac{1}{R}V=\frac{1}{R}V_{\rm in},
\\
& V(0)=V_0,
$$

ただし

- $V(t)$：電圧
- $C$：コンデンサの電気容量
- $V_{\rm in}$：定数入力．

これの解は

$$
V(t)=V_{\rm in}+\big(V_0-V_{\rm in}\big)e^{-t/(RC)}.
$$

となる．

**初期値**が**過渡応答**の大きさを決め，時間定数 (RC) が緩和速度を決める．
```
 -->
<!-- 
```{note}
**混合タンク（塩水）**

体積一定 (V)，流入濃度 (c_{\rm in})，流量 (q)：

$$
\frac{dM}{dt}=q(c_{\rm in}-\tfrac{M}{V}),\quad M(0)=M_0
\ \ \Rightarrow\ 
M(t)=V c_{\rm in}+\big(M_0-V c_{\rm in}\big)e^{-qt/V}.
$$

**初期値**は立ち上がりの**短時間挙動**に効くが，長期は**定常**に支配．
```
 -->

### ベルヌーイ型

- 一般形

$$
&\frac{dx}{dt}+p(t)x=q(t)x^n,
\\
&x(t=0)=x_0,
$$

ただし$n$は整数である．

※ $n=0,1$のときは線形となる．

- 解法
    - 変数変換$y(t)=x^{n-1}(t)$を施すと一階線形になる．

    $$
    \frac{dy}{dt} + (1-n)p(t)y = (1-n)q(t)
    $$

<!-- 
## 自律系・位相線と初期値依存

**自律系** ( \dot x=f(x) ) は時間に陽に依存しない．

- **平衡点**：(f(x^*)=0)．
- **安定性**：(f'(x^*)<0) なら安定，(>0) なら不安定．
- **初期値**がどの basin（吸引域）にいるかで**長期挙動**が変わる．

### 例：立方自己制御 ( \dot x = x - x^3 )

- 平衡 (x^*=0,\pm1)．
- (f'(0)=1>0) 不安定，(f'(\pm1)=-2<0) 安定．
- **初期値** (x_0) が正なら (+1) へ，負なら (-1) へ漸近．

**（Python：方向場＋軌道）**

```python
import numpy as np, matplotlib.pyplot as plt
def f(x): return x - x**3
xs = np.linspace(-1.5, 1.5, 21)
plt.axhline(0,color='k',lw=1); plt.plot(xs, f(xs))
plt.scatter([ -1, 0, 1 ], [0,0,0], c=['C0','C3','C0'])
plt.xlabel("x"); plt.ylabel("f(x)"); plt.grid(True, alpha=.3)
```
 -->
<!-- 
## 2階の基本例と初期条件

### 等速落下＋線形抵抗（1次元）

$$
m\frac{dv}{dt}=mg-\gamma v,\qquad v(0)=v_0.
$$
一次線形 ⇒
$$
v(t)=v_\infty + (v_0-v_\infty)e^{-t/\tau},\quad v_\infty=\frac{mg}{\gamma},\ \tau=\frac{m}{\gamma}.
$$
**初期条件**は過渡の違いだけを生み，長期は**終端速度** (v_\infty) に収束．

### 単振動（復習連動）

$$
\ddot x+\omega^2 x=0,\quad x(0)=x_0,\ \dot x(0)=v_0.
$$
一般解 (x(t)=A\cos(\omega t)+B\sin(\omega t))．
初期条件から
(
A=x_0,\ B=\frac{v_0}{\omega}
)
⇒ 振幅 (R=\sqrt{A^2+B^2})，**初期値が位相と振幅を決める**．
 -->
<!-- 
## 典型形と実世界モデルの早見表

| 形                            | 解き方   | 代表モデル    | 一般解（代表）                                     | 初期値の効き方 |
| ---------------------------- | ----- | -------- | ------------------------------------------- | ------- |
| (\dot x=ax)                  | 可分    | 放射性崩壊/利子 | (x=x_0 e^{at})                              | 縦スケール   |
| (\dot x=a-bx)                | 一次線形  | 冷却・RC    | (x=x_\infty+(x_0-x_\infty)e^{-bt})          | 過渡の大きさ  |
| (\dot x=rx(1-x/K))           | 可分    | 飽和成長     | (x=\dfrac{K}{1+(\frac{K-x_0}{x_0})e^{-rt}}) | 平衡への向き  |
| (m\ddot x+\gamma\dot x+kx=0) | 特性方程式 | 減衰振動     | 3ケース（過/臨/不足）                                | 位相・振幅   |
 -->
<!-- 
## ミニ演習（提出可）

```{note}
**演習1（可分形）**  
(1) \(\dot N = 0.8\,N\), \(N(0)=3\) の解を求め，グラフを描け．  
(2) \(\dot N = rN(1-N/K)\) の平衡点を求め，位相線で安定性を判定せよ．

**演習2（一次線形）**  
ニュートン冷却：\(T(0)=85^\circ{\rm C}\), \(T_{\rm env}=20^\circ{\rm C}\), \(k=0.25\,{\rm min}^{-1}\)．  
(1) 解を求め，30分後の温度を出せ．  
(2) 初期温度を \(60^\circ{\rm C}\) に変えたときの違いを重ね描きし，過渡の違いを説明せよ．

**演習3（自律系）**  
\(\dot x = x - x^3\)．  
(1) 平衡点と安定性を求めよ．  
(2) 初期値 \(x_0=\pm 0.2, \pm 0.8\) の数値解を描き，長期極限を答えよ．

**演習4（2階）**  
\(m\ddot x+\gamma\dot x+kx=0\)．  
(1) \(\gamma^2 \lessgtr 4mk\) で解の型を分類せよ．  
(2) 欠損根（臨界減衰）のときの一般解を導け．
```
 -->
<!-- 
## 補遺：解法チートシート

- **可分形**：右辺を $g(x)h(t)$ に分けて積分．
- **一次線形**：$\mu=e^{\int p}$ を掛けて全微分化．
- **定数係数2階**：特性方程式 $r^2+2\zeta\omega r+\omega^2=0$．
- **自律1階**：位相線・平衡の安定性・ベイズンで長期を読む．
 -->
